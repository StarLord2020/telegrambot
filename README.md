# Telegram Inline Audio Bot (Railway)

Простой инлайн‑бот для Телеграма: ищете трек прямо в строке ввода (`@имя_бота запрос`) и отправляете аудио сообщением. Сервер готов к деплою на Railway (webhook‑режим) и к локальному запуску (polling‑режим).

## Что умеет
- Инлайн‑поиск по локальной библиотеке аудио (`data/audios.json`).
- Ответ в инлайн‑режиме типом `audio` (вложение аудиофайла в чат).
- Webhook для продакшена (Railway), polling для локальной разработки.

## Быстрый старт (локально)
1. Требования: Node.js 18+.
2. Создайте бота через BotFather и получите токен.
3. Включите инлайн‑режим у бота через BotFather: `/setinline`.
4. Установите зависимости и запустите:
   ```bash
   npm install
   npm run dev
   ```
5. Установите переменные окружения:
   - `BOT_TOKEN` — токен бота.
   - Опционально: `USE_POLLING=true` для принудительного polling в dev.

Пример запуска:
```bash
BOT_TOKEN=123:ABC USE_POLLING=true npm run dev
```
Откройте любой чат и введите `@имя_бота` — увидите список треков из `data/audios.json`.

## Деплой на Railway (webhook)
1. Создайте новый проект в Railway и подключите этот репозиторий.
2. В переменных окружения проекта задайте:
   - `BOT_TOKEN` — токен бота.
   - `WEBHOOK_DOMAIN` — ваш домен Railway, например `https://your-app.up.railway.app`.
   - (опционально) `WEBHOOK_SECRET` — свой секрет для пути вебхука.
3. Задеплойте. Приложение автоматически выставит webhook на `WEBHOOK_DOMAIN/telegraf/WEBHOOK_SECRET`.
4. Убедитесь, что у бота включен инлайн‑режим: `/setinline`.

После деплоя можно проверить health: откройте `GET /` на домене Railway — должен вернуться `{ ok: true, mode: "webhook" }`.

## Конфигурация
- `data/audios.json` — локальная библиотека аудио. Формат элемента:
  ```json
  {
    "id": "unique-id",
    "title": "Song title",
    "performer": "Artist",
    "url": "https://example.com/file.mp3",
    "caption": "Optional caption"
  }
  ```
  В `url` должна быть доступная по HTTP(S) ссылка на mp3/аудио.

### Как добавить свои аудио
- Способ A (по ссылке):
  1) Загрузите свои mp3 куда‑нибудь с прямым HTTPS‑доступом (S3/R2, CDN, GitHub Releases, и т. п.).
  2) Добавьте запись в `data/audios.json` с полем `url` и нужными `title`/`performer`.
  3) Закоммитьте изменения и задеплойте — Railway перезапустит бот.

- Способ B (через Telegram file_id):
  1) Отправьте аудио в личку боту.
  2) Бот ответит готовым JSON‑фрагментом и выведет его в логи Railway.
  3) Скопируйте фрагмент в `data/audios.json`. Пример:
     ```json
     {
       "id": "AQA...unique",
       "title": "Мой трек",
       "performer": "Я",
       "file_id": "CQACAgQAAxkBA..."
     }
     ```
  4) Закоммитьте и задеплойте.

  Примечание: записи с `file_id` не требуют `url` — бот отправляет кэшированное аудио Telegram.

## Получить chat_id
- Команда: отправьте `/id` боту (в ЛС или в группе) — бот ответит `chat_id` и `user_id`.
- Deep‑link: откройте `https://t.me/<имя_бота>?start=id` и нажмите Start — бот пришлёт `chat_id` в ЛС.

- Среда:
  - `BOT_TOKEN` (обязательно)
  - `WEBHOOK_DOMAIN` (прод, Railway)
  - `WEBHOOK_SECRET` (опционально, по умолчанию генерируется на старте)
  - `PORT` (Railway задаёт автоматически)
  - `USE_POLLING` (для локалки)

## Команды
- `/start` — краткая подсказка.
- Инлайн‑режим: `@имя_бота <поиск>`

## Примечания
- Примеры аудио в `data/audios.json` используют публичные демо‑mp3 (SoundHelix). Подмените на свои ссылки или расширьте список.
- Если inline‑ответы не приходят — проверьте, включён ли инлайн у бота и правильно ли задан `WEBHOOK_DOMAIN`.

## Лицензия
Без лицензии — используйте на свой страх и риск.
